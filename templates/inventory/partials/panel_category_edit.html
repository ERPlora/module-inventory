{% load djicons i18n djicons djicons %}

<div x-data="{ confirmDelete: false }">

    <!-- Header -->
    <div class="side-sheet-header">
        <h3 class="sheet-title">{% trans "Edit Category" %}</h3>
        <button class="sheet-close" @click="closePanel()">
            {% icon "close-outline" %}
        </button>
    </div>

    <!-- Body -->
    <div class="side-sheet-content">
        <form id="edit-category-form"
              hx-post="{% url 'inventory:category_edit' category.id %}"
              hx-target="#datatable-body"
              hx-swap="innerHTML"
              hx-encoding="multipart/form-data"
              @htmx:after-request="closePanel()"
              class="flex flex-col gap-4 p-6">
            {% csrf_token %}

            {% if error %}
            <div class="callout callout-error">
                <div class="callout-content">
                    <span class="callout-text">{{ error }}</span>
                </div>
            </div>
            {% endif %}

            <!-- Preview -->
            <div class="text-center mb-2">
                <div class="w-16 h-16 rounded-lg flex items-center justify-center mx-auto text-2xl"
                     style="background-color: {{ category.color }}20; color: {{ category.color }};">
                    {% icon category.icon %}
                </div>
            </div>

            <!-- Name -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Name" %}</label>
                <input type="text" name="name" class="input input-sm w-full"
                       value="{{ category.name }}" placeholder="{% trans 'Category name' %}" required>
            </div>

            <!-- Description -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Description" %}</label>
                <textarea name="description" class="textarea textarea-sm w-full" rows="2"
                          placeholder="{% trans 'Optional description' %}">{{ category.description }}</textarea>
            </div>

            <!-- Icon & Color -->
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-sm font-medium mb-1 block">{% trans "Icon" %}</label>
                    <input type="text" name="icon" class="input input-sm w-full"
                           value="{{ category.icon }}">
                </div>
                <div>
                    <label class="text-sm font-medium mb-1 block">{% trans "Color" %}</label>
                    <input type="color" name="color" class="input input-sm w-full"
                           value="{{ category.color }}">
                </div>
            </div>

            <!-- Sort Order -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Sort Order" %}</label>
                <input type="number" name="sort_order" class="input input-sm w-full"
                       min="0" value="{{ category.sort_order }}">
            </div>

            <!-- Tax Class -->
            {% if tax_classes %}
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Default Tax Class" %}</label>
                <select name="tax_class" class="select select-sm w-full">
                    <option value="">{% trans "None" %}</option>
                    {% for tc in tax_classes %}
                    <option value="{{ tc.id }}" {% if category.tax_class_id == tc.id %}selected{% endif %}>{{ tc.name }} ({{ tc.rate }}%)</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            <!-- Image -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Image" %}</label>
                {% if category.image %}
                <div class="mb-2">
                    <img src="{{ category.image.url }}" alt="{{ category.name }}" class="w-20 h-20 rounded-lg object-cover">
                </div>
                {% endif %}
                <input type="file" name="image" accept="image/*" class="input input-sm w-full">
            </div>
        </form>

        <!-- Delete Section -->
        <div class="border-t border-base-300 pt-4 mt-4 px-6 pb-6">
            <h4 class="font-semibold text-sm mb-3 text-error">{% trans "Danger Zone" %}</h4>

            <template x-if="!confirmDelete">
                <button type="button" class="btn btn-sm btn-outline color-error w-full"
                        @click="confirmDelete = true">
                    {% icon "trash-outline" %}
                    {% trans "Delete Category" %}
                </button>
            </template>

            <template x-if="confirmDelete">
                <div>
                    <p class="text-error text-sm font-semibold mb-3">
                        {% trans "Are you sure?" %}
                    </p>
                    <div class="flex gap-2">
                        <button type="button" class="btn btn-sm btn-outline flex-1"
                                @click="confirmDelete = false">
                            {% trans "Cancel" %}
                        </button>
                        <button type="button" class="btn btn-sm color-error flex-1"
                                hx-post="{% url 'inventory:category_delete' category.id %}"
                                hx-target="#datatable-body"
                                hx-swap="innerHTML"
                                @click="closePanel()">
                            {% icon "trash-outline" %}
                            {% trans "Delete" %}
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Footer -->
    <div class="side-sheet-footer">
        <div class="flex justify-end gap-2">
            <button type="button" class="btn btn-ghost btn-sm" @click="closePanel()">
                {% trans "Cancel" %}
            </button>
            <button type="submit" form="edit-category-form" class="btn btn-sm color-primary">
                {% icon "checkmark-outline" %}
                {% trans "Save" %}
            </button>
        </div>
    </div>

</div>
