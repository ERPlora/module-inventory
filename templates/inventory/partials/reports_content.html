{% load static i18n ui component_tags %}

{% component "page"
    title=_("Inventory Reports")
    subtitle=_("Detailed statistics and analysis")
    module_id="inventory"
    tabbar_view="reports" %}

    {% fill "content" %}
        {# Primary Stats Row #}
        <div class="ui-grid ui-grid--stats mb-lg">
            {% ui_stat_card value=total_products label=_("Total Products") icon="cube-outline" color="primary" %}
            {% ui_stat_card value=products_in_stock label=_("In Stock") icon="checkmark-circle-outline" color="success" %}
            {% ui_stat_card value=products_low_stock label=_("Low Stock") icon="alert-circle-outline" color="warning" %}
            <ion-card class="ui-stat-card m-0">
                <ion-card-content class="p-md">
                    <div class="d-flex align-center gap-sm">
                        <div class="ui-stat-icon ui-stat-icon--success">
                            <ion-icon name="cash-outline"></ion-icon>
                        </div>
                        <div>
                            <div class="fs-xs text-secondary">{% trans "Total Value" %}</div>
                            <div class="ui-stat-value text-success">${{ total_inventory_value|floatformat:2 }}</div>
                        </div>
                    </div>
                </ion-card-content>
            </ion-card>
        </div>

        {# Secondary Stats Row #}
        <div class="ui-grid ui-grid--stats mb-lg">
            {% ui_stat_card value=products_out_of_stock label=_("Out of Stock") icon="close-circle-outline" color="danger" %}
            {% ui_stat_card value=total_categories label=_("Categories") icon="albums-outline" color="primary" %}
            {% ui_stat_card value=total_units label=_("Total Units") icon="layers-outline" color="success" %}
            <ion-card class="ui-stat-card m-0">
                <ion-card-content class="p-md">
                    <div class="d-flex align-center gap-sm">
                        <div class="ui-stat-icon ui-stat-icon--warning">
                            <ion-icon name="trending-down-outline"></ion-icon>
                        </div>
                        <div>
                            <div class="fs-xs text-secondary">{% trans "Cost Value" %}</div>
                            <div class="ui-stat-value text-warning">${{ total_cost_value|floatformat:2 }}</div>
                        </div>
                    </div>
                </ion-card-content>
            </ion-card>
        </div>

        {# Stock by Category #}
        {% ui_card css_class="mb-lg" %}
            <div class="mb-md">
                <span class="fw-semibold fs-lg">{% trans "Stock by Category" %}</span>
            </div>

            {% if category_stats %}
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>{% trans "Category" %}</th>
                            <th class="cell-center">{% trans "Products" %}</th>
                            <th class="cell-center">{% trans "Units" %}</th>
                            <th class="cell-right">{% trans "Value" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in category_stats %}
                        <tr>
                            <td>
                                <div class="d-flex align-center gap-sm">
                                    <div class="table-image-placeholder" style="width: 32px; height: 32px; background: {{ stat.color }}20; border-color: {{ stat.color }};">
                                        <ion-icon name="{{ stat.icon }}" style="color: {{ stat.color }}; font-size: 16px;"></ion-icon>
                                    </div>
                                    <span>{{ stat.name }}</span>
                                </div>
                            </td>
                            <td class="cell-center">{{ stat.product_count }}</td>
                            <td class="cell-center">{{ stat.total_stock }}</td>
                            <td class="cell-right fw-semibold text-success">${{ stat.total_value|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="table-empty">
                <ion-icon name="albums-outline" class="table-empty-icon"></ion-icon>
                <p>{% trans "No categories with products" %}</p>
            </div>
            {% endif %}
        {% endui_card %}

        {# Top Products Cards #}
        <div class="ui-grid ui-grid--2 mb-lg">
            {# Top Products by Value #}
            {% ui_card %}
                <div class="mb-md">
                    <span class="fw-semibold fs-lg">{% trans "Top Products by Stock Value" %}</span>
                </div>

                {% if top_products_by_value %}
                <div class="d-flex flex-column gap-sm">
                    {% for product in top_products_by_value %}
                    <div class="d-flex align-center justify-between p-sm rounded-lg" style="background: var(--bg-color-secondary);">
                        <div class="d-flex align-center gap-sm">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="table-image" style="width: 40px; height: 40px;">
                            {% else %}
                            <div class="table-image-placeholder" style="width: 40px; height: 40px;">
                                <ion-icon name="cube-outline"></ion-icon>
                            </div>
                            {% endif %}
                            <div>
                                <div class="fw-medium">{{ product.name }}</div>
                                <div class="fs-xs text-secondary">
                                    {{ product.stock }} {% trans "units" %} &times; ${{ product.price|floatformat:2 }}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="fw-semibold text-success">${{ product.stock_value|floatformat:2 }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="table-empty">
                    <p>{% trans "No products in stock" %}</p>
                </div>
                {% endif %}
            {% endui_card %}

            {# Top Products by Stock Quantity #}
            {% ui_card %}
                <div class="mb-md">
                    <span class="fw-semibold fs-lg">{% trans "Top Products by Stock Quantity" %}</span>
                </div>

                {% if top_products_by_stock %}
                <div class="d-flex flex-column gap-sm">
                    {% for product in top_products_by_stock %}
                    <div class="d-flex align-center justify-between p-sm rounded-lg" style="background: var(--bg-color-secondary);">
                        <div class="d-flex align-center gap-sm">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="table-image" style="width: 40px; height: 40px;">
                            {% else %}
                            <div class="table-image-placeholder" style="width: 40px; height: 40px;">
                                <ion-icon name="cube-outline"></ion-icon>
                            </div>
                            {% endif %}
                            <div>
                                <div class="fw-medium">{{ product.name }}</div>
                                <div class="fs-xs text-secondary">
                                    ${{ product.price|floatformat:2 }} {% trans "each" %}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="fw-semibold text-primary">{{ product.stock }} {% trans "units" %}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="table-empty">
                    <p>{% trans "No products in stock" %}</p>
                </div>
                {% endif %}
            {% endui_card %}
        </div>

        {# Critical Stock Alert #}
        {% if critical_stock_products %}
        {% ui_card %}
            <div class="d-flex align-center gap-sm mb-md">
                <ion-icon name="warning-outline" color="danger" style="font-size: 24px;"></ion-icon>
                <span class="fw-semibold fs-lg">{% trans "Critical Stock Products" %}</span>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>{% trans "Product" %}</th>
                            <th>{% trans "SKU" %}</th>
                            <th class="cell-center">{% trans "Current Stock" %}</th>
                            <th class="cell-center">{% trans "Threshold" %}</th>
                            <th class="cell-actions">{% trans "Actions" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in critical_stock_products %}
                        <tr>
                            <td>
                                <div class="d-flex align-center gap-sm">
                                    {% if product.image %}
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="table-image" style="width: 40px; height: 40px;">
                                    {% else %}
                                    <div class="table-image-placeholder" style="width: 40px; height: 40px;">
                                        <ion-icon name="cube-outline"></ion-icon>
                                    </div>
                                    {% endif %}
                                    <span>{{ product.name }}</span>
                                </div>
                            </td>
                            <td class="mono text-secondary">{{ product.sku }}</td>
                            <td class="cell-center">
                                <span class="table-stock-badge table-stock-badge--out">{{ product.stock }}</span>
                            </td>
                            <td class="cell-center text-secondary">{{ product.low_stock_threshold }}</td>
                            <td>
                                <div class="table-actions">
                                    <ion-button size="small" fill="clear" href="{% url 'inventory:product_edit' product.id %}">
                                        <ion-icon slot="icon-only" name="create-outline"></ion-icon>
                                    </ion-button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endui_card %}
        {% endif %}
    {% endfill %}
{% endcomponent %}
