{% load i18n djicons %}

<div class="p-4">
    <!-- Page Header -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold">{% trans "Inventory Reports" %}</h1>
        <p class="text-sm mt-1 opacity-60">{% trans "Detailed statistics and analysis" %}</p>
    </div>

    <!-- Stats Cards Row 1 -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center">
                        {% icon "cube-outline" css_class="text-xl text-primary" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "Total Products" %}</div>
                        <div class="text-xl font-semibold">{{ total_products }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-success/10 rounded-xl flex items-center justify-center">
                        {% icon "checkmark-circle-outline" css_class="text-xl text-success" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "In Stock" %}</div>
                        <div class="text-xl font-semibold">{{ products_in_stock }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-warning/10 rounded-xl flex items-center justify-center">
                        {% icon "alert-circle-outline" css_class="text-xl text-warning" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "Low Stock" %}</div>
                        <div class="text-xl font-semibold">{{ products_low_stock }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-success/10 rounded-xl flex items-center justify-center">
                        {% icon "cash-outline" css_class="text-xl text-success" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "Total Value" %}</div>
                        <div class="text-xl font-semibold">{{ total_inventory_value|floatformat:2 }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards Row 2 -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-error/10 rounded-xl flex items-center justify-center">
                        {% icon "close-circle-outline" css_class="text-xl text-error" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "Out of Stock" %}</div>
                        <div class="text-xl font-semibold">{{ products_out_of_stock }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center">
                        {% icon "albums-outline" css_class="text-xl text-primary" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "Categories" %}</div>
                        <div class="text-xl font-semibold">{{ total_categories }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-success/10 rounded-xl flex items-center justify-center">
                        {% icon "layers-outline" css_class="text-xl text-success" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "Total Units" %}</div>
                        <div class="text-xl font-semibold">{{ total_units }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-warning/10 rounded-xl flex items-center justify-center">
                        {% icon "trending-down-outline" css_class="text-xl text-warning" %}
                    </div>
                    <div>
                        <div class="text-xs opacity-60">{% trans "Cost Value" %}</div>
                        <div class="text-xl font-semibold">{{ total_cost_value|floatformat:2 }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Status by Category -->
    <div class="card mb-6">
        <div class="card-header">
            <h3 class="card-title">{% trans "Stock by Category" %}</h3>
        </div>
        <div class="card-body p-0">
            {% if category_stats %}
            <div class="overflow-x-auto">
                <table class="datatable-table">
                    <thead class="datatable-thead">
                        <tr>
                            <th class="datatable-th">{% trans "Category" %}</th>
                            <th class="datatable-th datatable-th-center">{% trans "Products" %}</th>
                            <th class="datatable-th datatable-th-center">{% trans "Units" %}</th>
                            <th class="datatable-th" style="text-align: right;">{% trans "Value" %}</th>
                        </tr>
                    </thead>
                    <tbody class="datatable-tbody">
                        {% for stat in category_stats %}
                        <tr class="datatable-tr">
                            <td class="datatable-td">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded flex items-center justify-center"
                                         style="background-color: {{ stat.color }}20; color: {{ stat.color }};">
                                        {% icon stat.icon %}
                                    </div>
                                    <span>{{ stat.name }}</span>
                                </div>
                            </td>
                            <td class="datatable-td datatable-td-center">{{ stat.product_count }}</td>
                            <td class="datatable-td datatable-td-center">{{ stat.total_stock }}</td>
                            <td class="datatable-td text-right font-semibold text-success">{{ stat.total_value|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-8 opacity-50">
                {% icon "albums-outline" css_class="text-4xl" %}
                <p class="mt-2">{% trans "No categories with products" %}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Top Products by Value / Stock -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">{% trans "Top Products by Stock Value" %}</h3>
            </div>
            <div class="card-body">
                {% if top_products_by_value %}
                <div class="space-y-3">
                    {% for product in top_products_by_value %}
                    <div class="flex items-center justify-between p-3 rounded-lg bg-base-200/50">
                        <div class="flex items-center gap-3">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-10 h-10 object-cover rounded-lg">
                            {% else %}
                            <div class="w-10 h-10 flex items-center justify-center rounded-lg bg-base-200">
                                {% icon "cube-outline" css_class="opacity-50" %}
                            </div>
                            {% endif %}
                            <div>
                                <div class="font-medium text-sm">{{ product.name }}</div>
                                <div class="text-xs opacity-60">
                                    {{ product.stock }} {% trans "units" %} x {{ product.price|floatformat:2 }}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-success">{{ product.stock_value|floatformat:2 }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 opacity-50">
                    <p>{% trans "No products in stock" %}</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">{% trans "Top Products by Stock Quantity" %}</h3>
            </div>
            <div class="card-body">
                {% if top_products_by_stock %}
                <div class="space-y-3">
                    {% for product in top_products_by_stock %}
                    <div class="flex items-center justify-between p-3 rounded-lg bg-base-200/50">
                        <div class="flex items-center gap-3">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-10 h-10 object-cover rounded-lg">
                            {% else %}
                            <div class="w-10 h-10 flex items-center justify-center rounded-lg bg-base-200">
                                {% icon "cube-outline" css_class="opacity-50" %}
                            </div>
                            {% endif %}
                            <div>
                                <div class="font-medium text-sm">{{ product.name }}</div>
                                <div class="text-xs opacity-60">
                                    {{ product.price|floatformat:2 }} {% trans "each" %}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-primary">{{ product.stock }} {% trans "units" %}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 opacity-50">
                    <p>{% trans "No products in stock" %}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Critical Stock Alert -->
    {% if critical_stock_products %}
    <div class="card">
        <div class="card-header">
            <div class="flex items-center gap-2">
                {% icon "warning-outline" css_class="text-error" %}
                <h3 class="card-title">{% trans "Critical Stock Products" %}</h3>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="overflow-x-auto">
                <table class="datatable-table">
                    <thead class="datatable-thead">
                        <tr>
                            <th class="datatable-th">{% trans "Product" %}</th>
                            <th class="datatable-th">{% trans "SKU" %}</th>
                            <th class="datatable-th datatable-th-center">{% trans "Current Stock" %}</th>
                            <th class="datatable-th datatable-th-center">{% trans "Threshold" %}</th>
                        </tr>
                    </thead>
                    <tbody class="datatable-tbody">
                        {% for product in critical_stock_products %}
                        <tr class="datatable-tr">
                            <td class="datatable-td">
                                <div class="flex items-center gap-3">
                                    {% if product.image %}
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-10 h-10 object-cover rounded-lg">
                                    {% else %}
                                    <div class="w-10 h-10 flex items-center justify-center rounded-lg bg-base-200">
                                        {% icon "cube-outline" css_class="opacity-50" %}
                                    </div>
                                    {% endif %}
                                    <span>{{ product.name }}</span>
                                </div>
                            </td>
                            <td class="datatable-td">
                                <span class="font-mono text-sm opacity-60">{{ product.sku }}</span>
                            </td>
                            <td class="datatable-td datatable-td-center">
                                <span class="badge {% if product.stock == 0 %}color-error{% else %}color-warning{% endif %}">
                                    {{ product.stock }}
                                </span>
                            </td>
                            <td class="datatable-td datatable-td-center opacity-60">{{ product.low_stock_threshold }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
