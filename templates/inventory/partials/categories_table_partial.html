{% load i18n %}

{# Categories Table with infinite scroll #}
<div class="data-table-container">
    <table class="data-table">
        <thead>
            <tr>
                {# ID #}
                <th class="cell-narrow">ID</th>

                {# Icon/Image #}
                <th class="cell-narrow">{% trans "Icon" %}</th>

                {# Name (sortable) #}
                <th class="sortable"
                    hx-get="{{ request.path }}"
                    hx-target="#categories-table-container"
                    hx-include="[name='search'],[name='per_page']"
                    hx-vals='{"order_by": "{% if order_by == "name" %}-name{% elif order_by == "-name" %}name{% else %}-name{% endif %}"}'
                    hx-push-url="true">
                    {% trans "Name" %}
                    {% if order_by == "name" %}
                    <ion-icon name="chevron-up-outline" class="sort-icon"></ion-icon>
                    {% elif order_by == "-name" %}
                    <ion-icon name="chevron-down-outline" class="sort-icon"></ion-icon>
                    {% endif %}
                </th>

                {# Description #}
                <th class="hide-mobile">{% trans "Description" %}</th>

                {# Product Count #}
                <th class="cell-center cell-narrow">{% trans "Products" %}</th>

                {# Order (sortable) #}
                <th class="sortable cell-center cell-narrow"
                    hx-get="{{ request.path }}"
                    hx-target="#categories-table-container"
                    hx-include="[name='search'],[name='per_page']"
                    hx-vals='{"order_by": "{% if order_by == "order" %}-order{% elif order_by == "-order" %}order{% else %}order{% endif %}"}'
                    hx-push-url="true">
                    {% trans "Order" %}
                    {% if order_by == "order" %}
                    <ion-icon name="chevron-up-outline" class="sort-icon"></ion-icon>
                    {% elif order_by == "-order" %}
                    <ion-icon name="chevron-down-outline" class="sort-icon"></ion-icon>
                    {% endif %}
                </th>

                {# Actions #}
                <th class="cell-actions">{% trans "Actions" %}</th>
            </tr>
        </thead>
        {% include "inventory/partials/categories_table_rows.html" %}
    </table>

    {# Infinite scroll trigger #}
    {% if has_next %}
    <div class="infinite-scroll-loader"
         hx-get="{{ request.path }}?page={{ next_page }}{% if search %}&search={{ search }}{% endif %}{% if order_by %}&order_by={{ order_by }}{% endif %}&per_page={{ per_page }}"
         hx-trigger="revealed"
         hx-target="#categories-tbody"
         hx-swap="beforeend"
         hx-select="#categories-tbody > tr, .infinite-scroll-loader, .infinite-scroll-end">
        <ion-spinner name="crescent"></ion-spinner>
    </div>
    {% else %}
    {% if total_count > 0 %}
    <div class="infinite-scroll-end">
        {% blocktrans count count=total_count %}{{ count }} category{% plural %}{{ count }} categories{% endblocktrans %}
    </div>
    {% endif %}
    {% endif %}
</div>
