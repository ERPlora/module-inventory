{% extends "core/app_base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Inventario" %} - CPOS Hub{% endblock %}

{% block content %}
<div class="p-4">
    <!-- Page Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold" style="color: var(--ion-text-color);">{% trans "Inventario" %}</h1>
        <p class="text-sm mt-2" style="color: var(--ion-color-medium);">{% trans "Gestión de productos, categorías y stock" %}</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <ion-card class="m-0">
            <ion-card-content class="p-6">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center">
                        <ion-icon name="cube-outline" class="text-2xl text-primary"></ion-icon>
                    </div>
                    <div>
                        <div class="text-sm text-medium">{% trans "Total Productos" %}</div>
                        <div class="text-2xl font-semibold">{{ total_products }}</div>
                    </div>
                </div>
            </ion-card-content>
        </ion-card>

        <ion-card class="m-0">
            <ion-card-content class="p-6">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-success/10 rounded-xl flex items-center justify-center">
                        <ion-icon name="checkmark-circle-outline" class="text-2xl text-success"></ion-icon>
                    </div>
                    <div>
                        <div class="text-sm text-medium">{% trans "En Stock" %}</div>
                        <div class="text-2xl font-semibold">{{ products_in_stock }}</div>
                    </div>
                </div>
            </ion-card-content>
        </ion-card>

        <ion-card class="m-0">
            <ion-card-content class="p-6">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-warning/10 rounded-xl flex items-center justify-center">
                        <ion-icon name="alert-circle-outline" class="text-2xl text-warning"></ion-icon>
                    </div>
                    <div>
                        <div class="text-sm text-medium">{% trans "Stock Bajo" %}</div>
                        <div class="text-2xl font-semibold">{{ products_low_stock }}</div>
                    </div>
                </div>
            </ion-card-content>
        </ion-card>

        <ion-card class="m-0">
            <ion-card-content class="p-6">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-success/10 rounded-xl flex items-center justify-center">
                        <ion-icon name="cash-outline" class="text-2xl text-success"></ion-icon>
                    </div>
                    <div>
                        <div class="text-sm text-medium">{% trans "Valor Total" %}</div>
                        <div class="text-2xl font-semibold">${{ total_inventory_value|floatformat:2 }}</div>
                    </div>
                </div>
            </ion-card-content>
        </ion-card>
    </div>

    <!-- Quick Actions & Categories -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
        <!-- Quick Actions -->
        <ion-card class="m-0">
            <ion-card-header>
                <ion-card-title>{% trans "Acciones Rápidas" %}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
                <div class="grid grid-cols-1 gap-3">
                    <ion-button expand="block" href="/modules/inventory/products/">
                        <ion-icon slot="start" name="cube-outline"></ion-icon>
                        {% trans "Ver Productos" %}
                    </ion-button>
                    <ion-button expand="block" href="/modules/inventory/categories/" fill="outline">
                        <ion-icon slot="start" name="albums-outline"></ion-icon>
                        {% trans "Gestionar Categorías" %}
                    </ion-button>
                    <ion-button expand="block" href="/modules/inventory/reports/" fill="outline">
                        <ion-icon slot="start" name="stats-chart-outline"></ion-icon>
                        {% trans "Informes" %}
                    </ion-button>
                    <ion-button expand="block" href="/modules/inventory/settings/" fill="outline">
                        <ion-icon slot="start" name="settings-outline"></ion-icon>
                        {% trans "Configuración" %}
                    </ion-button>
                </div>
            </ion-card-content>
        </ion-card>

        <!-- Categories Summary -->
        <ion-card class="m-0">
            <ion-card-header>
                <div class="flex justify-between items-center">
                    <ion-card-title>{% trans "Categorías" %}</ion-card-title>
                    <ion-button size="small" fill="clear" href="/modules/inventory/categories/">
                        {% trans "Ver todas" %}
                        <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
                    </ion-button>
                </div>
            </ion-card-header>
            <ion-card-content>
                {% if categories %}
                <div class="space-y-3">
                    {% for category in categories %}
                    <div class="flex items-center justify-between p-3 rounded-lg" style="background: var(--ion-color-light);">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 flex items-center justify-center rounded-lg" style="background: {{ category.color }}20;">
                                <ion-icon name="{{ category.icon }}" style="color: {{ category.color }}; font-size: 20px;"></ion-icon>
                            </div>
                            <div>
                                <div class="font-medium" style="color: var(--ion-text-color);">{{ category.name }}</div>
                                <div class="text-xs" style="color: var(--ion-color-medium);">{{ category.product_count }} {% trans "productos" %}</div>
                            </div>
                        </div>
                        <ion-button fill="clear" size="small" href="/modules/inventory/categories/edit/{{ category.id }}/">
                            <ion-icon slot="icon-only" name="chevron-forward-outline"></ion-icon>
                        </ion-button>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8" style="color: var(--ion-color-medium);">
                    <ion-icon name="albums-outline" style="font-size: 48px;"></ion-icon>
                    <p class="mt-2">{% trans "No hay categorías creadas" %}</p>
                    <ion-button size="small" href="/modules/inventory/categories/create/" class="mt-3" color="success">
                        {% trans "Crear primera categoría" %}
                    </ion-button>
                </div>
                {% endif %}
            </ion-card-content>
        </ion-card>
    </div>

    <!-- Low Stock Products -->
    {% if low_stock_products %}
    <ion-card class="m-0">
        <ion-card-header>
            <div class="flex justify-between items-center">
                <ion-card-title>
                    <ion-icon name="alert-circle-outline" class="text-warning" style="vertical-align: middle;"></ion-icon>
                    {% trans "Productos con Stock Bajo" %}
                </ion-card-title>
                <ion-button size="small" fill="clear" href="/modules/inventory/products/?low_stock=1">
                    {% trans "Ver todos" %}
                    <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
                </ion-button>
            </div>
        </ion-card-header>
        <ion-card-content>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead style="background: var(--ion-color-step-50);">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-medium" style="color: var(--ion-color-medium);">{% trans "Producto" %}</th>
                            <th class="px-4 py-3 text-left text-sm font-medium" style="color: var(--ion-color-medium);">{% trans "SKU" %}</th>
                            <th class="px-4 py-3 text-center text-sm font-medium" style="color: var(--ion-color-medium);">{% trans "Stock" %}</th>
                            <th class="px-4 py-3 text-center text-sm font-medium" style="color: var(--ion-color-medium);">{% trans "Umbral" %}</th>
                            <th class="px-4 py-3 text-center text-sm font-medium" style="color: var(--ion-color-medium);">{% trans "Acciones" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in low_stock_products %}
                        <tr class="border-b" style="border-color: var(--ion-border-color);">
                            <td class="px-4 py-3 text-sm">
                                <div class="flex items-center gap-3">
                                    {% if product.image %}
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-10 h-10 object-cover rounded-lg">
                                    {% else %}
                                    <div class="w-10 h-10 flex items-center justify-center rounded-lg" style="background: var(--ion-color-light);">
                                        <ion-icon name="cube-outline" style="color: var(--ion-color-medium);"></ion-icon>
                                    </div>
                                    {% endif %}
                                    <span>{{ product.name }}</span>
                                </div>
                            </td>
                            <td class="px-4 py-3 text-sm font-mono" style="color: var(--ion-color-medium);">{{ product.sku }}</td>
                            <td class="px-4 py-3 text-center">
                                <span class="px-2 py-1 rounded-full text-xs font-medium" style="background: var(--ion-color-warning-tint); color: var(--ion-color-warning-contrast);">
                                    {{ product.stock }}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-center text-sm" style="color: var(--ion-color-medium);">{{ product.low_stock_threshold }}</td>
                            <td class="px-4 py-3 text-center">
                                <ion-button size="small" fill="clear" href="/modules/inventory/products/{{ product.id }}/edit/">
                                    <ion-icon slot="icon-only" name="create-outline"></ion-icon>
                                </ion-button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </ion-card-content>
    </ion-card>
    {% endif %}
</div>
{% endblock %}
