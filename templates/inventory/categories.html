{% extends "core/app_base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Categorías" %} - Inventory{% endblock %}

{% block content %}
<div class="p-4">
    <!-- Categories Table -->
    <ion-card class="my-4">
        <ion-card-header>
            <div class="flex justify-between items-center flex-wrap gap-3">
                <ion-card-title>{% trans "Categorías" %}</ion-card-title>
                <div class="flex gap-2 flex-wrap">
                    <ion-button size="large" href="/plugins/inventory/categories/create/">
                        <ion-icon slot="start" name="add-outline"></ion-icon>
                        {% trans "Nueva Categoría" %}
                    </ion-button>
                </div>
            </div>
        </ion-card-header>

        <!-- Search Bar -->
        <div class="px-4 pb-4">
            <div class="relative flex-1">
                <ion-icon
                    name="search-outline"
                    class="absolute left-3 top-1/2 -translate-y-1/2"
                    style="color: var(--ion-color-medium); pointer-events: none; z-index: 10;">
                </ion-icon>
                <input
                    type="text"
                    name="search"
                    value="{{ request.GET.search|default:'' }}"
                    placeholder="{% trans 'Buscar categorías...' %}"
                    class="w-full h-10 pl-10 pr-3 rounded-lg"
                    style="border: 1px solid var(--ion-border-color); background: var(--ion-background-color); color: var(--ion-text-color);"
                    hx-get="{{ request.path }}"
                    hx-trigger="keyup changed delay:400ms"
                    hx-target="#categories-table-container"
                    hx-include="[name='page'],[name='order_by'],[name='per_page']"
                    hx-push-url="true">
            </div>
        </div>

        <!-- Table Container (HTMX updates this) -->
        <div id="categories-table-container">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead style="background: var(--ion-color-step-50);">
                        <tr>
                            <!-- ID -->
                            <th class="px-4 py-3 text-left text-sm font-medium" style="color: var(--ion-color-medium); width: 80px;">
                                ID
                            </th>

                            <!-- Icon/Image -->
                            <th class="px-4 py-3 text-left text-sm font-medium" style="color: var(--ion-color-medium); width: 80px;">
                                {% trans "Icono" %}
                            </th>

                            <!-- Name (sortable) -->
                            <th
                                class="px-4 py-3 text-left text-sm font-medium cursor-pointer hover:bg-opacity-80 select-none"
                                style="color: var(--ion-color-medium);"
                                hx-get="{{ request.path }}"
                                hx-target="#categories-table-container"
                                hx-include="[name='search'],[name='page'],[name='per_page']"
                                hx-vals='{"order_by": "{% if request.GET.order_by == "name" %}-name{% elif request.GET.order_by == "-name" %}name{% else %}-name{% endif %}"}'
                                hx-push-url="true">
                                {% trans "Nombre" %}
                                {% if request.GET.order_by == "name" %}
                                <ion-icon name="chevron-up-outline" style="font-size: 14px; vertical-align: middle;"></ion-icon>
                                {% elif request.GET.order_by == "-name" %}
                                <ion-icon name="chevron-down-outline" style="font-size: 14px; vertical-align: middle;"></ion-icon>
                                {% endif %}
                            </th>

                            <!-- Description -->
                            <th class="px-4 py-3 text-left text-sm font-medium" style="color: var(--ion-color-medium);">
                                {% trans "Descripción" %}
                            </th>

                            <!-- Product Count -->
                            <th class="px-4 py-3 text-center text-sm font-medium" style="color: var(--ion-color-medium); width: 120px;">
                                {% trans "Productos" %}
                            </th>

                            <!-- Order (sortable) -->
                            <th
                                class="px-4 py-3 text-center text-sm font-medium cursor-pointer hover:bg-opacity-80 select-none"
                                style="color: var(--ion-color-medium); width: 100px;"
                                hx-get="{{ request.path }}"
                                hx-target="#categories-table-container"
                                hx-include="[name='search'],[name='page'],[name='per_page']"
                                hx-vals='{"order_by": "{% if request.GET.order_by == "order" %}-order{% elif request.GET.order_by == "-order" %}order{% else %}order{% endif %}"}'
                                hx-push-url="true">
                                {% trans "Orden" %}
                                {% if request.GET.order_by == "order" %}
                                <ion-icon name="chevron-up-outline" style="font-size: 14px; vertical-align: middle;"></ion-icon>
                                {% elif request.GET.order_by == "-order" %}
                                <ion-icon name="chevron-down-outline" style="font-size: 14px; vertical-align: middle;"></ion-icon>
                                {% endif %}
                            </th>

                            <!-- Actions -->
                            <th class="px-4 py-3 text-center text-sm font-medium" style="color: var(--ion-color-medium); width: 120px;">
                                {% trans "Acciones" %}
                            </th>
                        </tr>
                    </thead>
                    {% include "inventory/partials/categories_table_rows.html" %}
                </table>
            </div>

            <ion-card-content>
                {% include "inventory/partials/categories_pagination.html" %}
            </ion-card-content>
        </div>
    </ion-card>
</div>
{% endblock %}
